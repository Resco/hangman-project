<!DOCTYPE html> 
<html lang="en">
	<head>
		<meta charset="utf-8" />		
		<title>Mastermind</title>
		<meta name="description" content="A simple implementation of Hangman" >
	</head>
	
	<body>
		<header>
			<h1>This is Mastermind</h1>
			<nav>Please login or register</nav>
		</header>
		<div id='main'>
			
			<div id='display'>&nbsp;</div>
			
			<section id='log'>
				<h3>Login</h3>
				<form id='login'>
			        <label for='nick_login'>Your Nickname</label><br/>
			        <input type="text" name="nick_login" value="" id='nick_login'/><br/>
			
			        <label for="password_login">Your Password</label><br/>
			        <input type="password" name="password_login" value="" id="password_login"/><br/>
			
			        <input type="submit" value="Login" />
	   			</form>
			</section>
				
			<section id='reg'>
				<h3>Register</h3>
				<form id='register'>
					<label for='nick_reg'>Nickname</label><br/>
				    <input type="text" name="nick_reg" value="" id='nick_reg'/><br/>
				
				    <label for="password_reg">Password</label><br/>
				    <input type="password" name="password_reg" value="" id="password_reg"/><br/>
						
					<label for="re_password_reg">Repeat Password</label><br/>
				    <input type="password" name="re_password_reg" value="" id="re_password_reg"/><br/>
						
					<label for='mail_reg'>Mail</label><br/>
				    <input type='text' name="mail_reg" value="" id='mail_reg'/><br/>
						
				    <input type="submit" value="Register" />    
	      		</form>
			</section>	
			
			<section id='current'>
				
			</section>
			
			<section id='history'>
				
			</section>
			
			<section id='scores'>
				
			</section>
				
		</div>
		
		<footer>
			<div id='author'>Autore: Luca Resconi XXXXXX</div>
			<div id='exam'>Appello: Settembre 2014</div>
		</footer>
		
		<script src='/js/lib/jquery-1.10.2.min.js'></script>
		<script>
			$(document).ready(function() {
        		$("#register").submit(on_register);
				$("#login").submit(on_login);
				check_log();
      		});
			
			function check_log() {
        		$.ajax({
          			url: '/logged',
          			method: 'get',
          			success: on_login_success,
        		})
      		}
			
			
			function on_register() {
        		$.ajax({
          			url: '/register',
          			method: 'post',
          			success: on_register_success,
          			error: on_register_error,
          			data: {
            			nickname: $("#nick_reg").val(),
            			password: $("#password_reg").val(),
						re_password: $("#re_password_reg").val(),
						mail: $("#mail_reg").val(),
          			},
        		});
        	return false;
      		}
			
			function on_register_success(data) {
				$("#display").text(data.description);
				$("#register")[0].reset();
      		}

      		function on_register_error(data) {
				$("#display").text(JSON.stringify(data.responseJSON));
      		}
			
			function on_login() {
        		$.ajax({
          			url: '/authenticate',
          			method: 'post',
          			success: on_login_success,
          			error: on_login_error,
          			data: {
            			nickname: $("#nick_login").val(),
            			password: $("#password_login").val(),
          			},
        		});
        	return false;
      		}
			
			function on_login_success(data) {
				$("#login")[0].reset();
				$("#log").fadeOut();
				$("#reg").fadeOut();
				$("#display").text(data.description);
				var navigation = <button class="link">Clicky</button>;
				$("nav").html(navigation);
      		}

      		function on_login_error(data) {
				$("#display").text(JSON.stringify(data.responseJSON));
      		}
	  
	  	</script>
	</body>
</html>
